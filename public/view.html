<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>ユーザー表示</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="sidebar">
      <a href="/">← ホーム</a>
      <a id="editlink">編集</a>
      <a id="historylink">履歴</a>
    </div>

    <div id="content">
      <h1 id="title"></h1>
      <img id="icon" class="user-icon" />
      <div id="bodydiv"></div>
    </div>

    <script>
      function wikiToHtml(str) {
        if (!str) return "";
        return str
          .replace(/\n/g, "<br>")
          .replace(/\*\*(.*?)\*\*/g, "<b>$1</b>")
          .replace(/\*(.*?)\*/g, "<i>$1</i>")
          .replace(/__(.*?)__/g, "<u>$1</u>")
          .replace(/~~(.*?)~~/g, "<del>$1</del>")
          .replace(/### (.*)/g, "<h3>$1</h3>")
          .replace(/## (.*)/g, "<h2>$1</h2>")
          .replace(
            /\[size=(\d+)\](.*?)\[\/size\]/g,
            '<span style="font-size:$1px">$2</span>'
          );
      }

      async function load() {
        const url = new URL(location.href);
        const uname = url.searchParams.get("username");
        if (!uname) return;
        editlink.href = "/edit.html?username=" + encodeURIComponent(uname);
        historylink.href =
          "/history.html?username=" + encodeURIComponent(uname);
        const d = await fetch(
          "/api/user?username=" + encodeURIComponent(uname)
        ).then((r) => r.json());
        if (!d.user) return;
        title.textContent = d.user.username;
        icon.src = d.user.icon || "";
        bodydiv.innerHTML = wikiToHtml(d.user.body);
      }
      load();
    </script>
  </body>
</html>
